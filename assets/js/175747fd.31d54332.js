"use strict";(self.webpackChunkgo_4_clouds=self.webpackChunkgo_4_clouds||[]).push([[1380],{3905:(e,n,a)=>{a.d(n,{Zo:()=>i,kt:()=>g});var t=a(7294);function l(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function p(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function r(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?p(Object(a),!0).forEach((function(n){l(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function o(e,n){if(null==e)return{};var a,t,l=function(e,n){if(null==e)return{};var a,t,l={},p=Object.keys(e);for(t=0;t<p.length;t++)a=p[t],n.indexOf(a)>=0||(l[a]=e[a]);return l}(e,n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(t=0;t<p.length;t++)a=p[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(l[a]=e[a])}return l}var s=t.createContext({}),m=function(e){var n=t.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):r(r({},n),e)),a},i=function(e){var n=m(e.components);return t.createElement(s.Provider,{value:n},e.children)},c="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},d=t.forwardRef((function(e,n){var a=e.components,l=e.mdxType,p=e.originalType,s=e.parentName,i=o(e,["components","mdxType","originalType","parentName"]),c=m(a),d=l,g=c["".concat(s,".").concat(d)]||c[d]||u[d]||p;return a?t.createElement(g,r(r({ref:n},i),{},{components:a})):t.createElement(g,r({ref:n},i))}));function g(e,n){var a=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var p=a.length,r=new Array(p);r[0]=d;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o[c]="string"==typeof e?e:l,r[1]=o;for(var m=2;m<p;m++)r[m]=a[m];return t.createElement.apply(null,r)}return t.createElement.apply(null,a)}d.displayName="MDXCreateElement"},2291:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>p,metadata:()=>o,toc:()=>m});var t=a(7462),l=(a(7294),a(3905));const p={sidebar_position:8},r="Create ConfigMap and Secret",o={unversionedId:"kubernetes/configmaps-and-secrets",id:"kubernetes/configmaps-and-secrets",title:"Create ConfigMap and Secret",description:"Learn how to use ConfigMap and Secret",source:"@site/docs/kubernetes/configmaps-and-secrets.md",sourceDirName:"kubernetes",slug:"/kubernetes/configmaps-and-secrets",permalink:"/docs/docs/kubernetes/configmaps-and-secrets",draft:!1,tags:[],version:"current",sidebarPosition:8,frontMatter:{sidebar_position:8},sidebar:"tutorialSidebar",previous:{title:"Use ReplicaSet and Deployment",permalink:"/docs/docs/kubernetes/replicaset-and-deployment"},next:{title:"Create Persistent Volume",permalink:"/docs/docs/kubernetes/persistent-volume"}},s={},m=[{value:"Use ConfigMap as env variables",id:"use-configmap-as-env-variables",level:2},{value:"Store configuration files as ConfigMap",id:"store-configuration-files-as-configmap",level:2},{value:"Use Secret object",id:"use-secret-object",level:2}],i={toc:m};function c(e){let{components:n,...a}=e;return(0,l.kt)("wrapper",(0,t.Z)({},i,a,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"create-configmap-and-secret"},"Create ConfigMap and Secret"),(0,l.kt)("p",null,"Learn how to use ",(0,l.kt)("inlineCode",{parentName:"p"},"ConfigMap")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"Secret")),(0,l.kt)("h2",{id:"use-configmap-as-env-variables"},"Use ConfigMap as env variables"),(0,l.kt)("p",null,"Check list of namespaces:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get ns\n")),(0,l.kt)("p",null,"Create new ",(0,l.kt)("inlineCode",{parentName:"p"},"myapp")," namespace for pod instance:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl create ns myapp\n")),(0,l.kt)("p",null,"Create ConfigMap with application data:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'kubectl create configmap -n myapp myapp \\\n        --from-literal=port="8083" \\\n        --from-literal=message="This is my own MyAPP message v2.X!" \\\n        --dry-run -o yaml > cm-myapp.yaml\n')),(0,l.kt)("p",null,"Check ConfigMap ",(0,l.kt)("inlineCode",{parentName:"p"},"myapp")," manifest:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="cm-myapp.yaml"',title:'"cm-myapp.yaml"'},'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: myapp\n  namespace: myapp\ndata:\n  port: "8083"\n  message: This is my own MyAPP message v2.X!\n')),(0,l.kt)("p",null,"Apply ConfigMap manifest:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f cm-myapp.yaml\n")),(0,l.kt)("p",null,"Generate ",(0,l.kt)("inlineCode",{parentName:"p"},"myapp")," Deployment:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl create deployment -n myapp myapp \\\n        --image=ghcr.io/mjura/myapp:v2.0 \\\n        --replicas=3 --dry-run -o yaml > deploy-myapp.yaml\n")),(0,l.kt)("p",null,"Edit Deployment template manifest for ",(0,l.kt)("inlineCode",{parentName:"p"},"myapp"),": "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="deploy-myapp.yaml"',title:'"deploy-myapp.yaml"'},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: myapp\n  namespace: myapp\nspec:\n  selector:\n    matchLabels:\n      app: myapp\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: myapp\n    spec:\n      containers:\n      - name: myapp\n        image: ghcr.io/mjura/myapp:v2.0\n        env:\n        - name: MYAPP_PORT\n          valueFrom:\n            configMapKeyRef:\n              name: myapp\n              key: port\n        - name: MYAPP_MESSAGE\n          valueFrom:\n            configMapKeyRef:\n              name: myapp\n              key: message\n")),(0,l.kt)("p",null,"Apply Deployment ",(0,l.kt)("inlineCode",{parentName:"p"},"deploy-myapp.yaml")," manifest:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f deploy-myapp.yaml\n")),(0,l.kt)("p",null,"Check Deploymnet,ReplicaSet and Pod status:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get deploy,rs,pods -n myapp -o wide\n")),(0,l.kt)("p",null,"Open tunnel connection to any Pod instance:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl port-forward -n myapp pod/myapp-<POD_ID> 8083:8083\n")),(0,l.kt)("p",null,"In new terminal check application response:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"curl http://127.0.0.1:8083\n")),(0,l.kt)("p",null,"To cleanup remove whole namespace:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl delete ns myapp\n")),(0,l.kt)("h2",{id:"store-configuration-files-as-configmap"},"Store configuration files as ConfigMap"),(0,l.kt)("p",null,"Check list of namespaces:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get ns\n")),(0,l.kt)("p",null,"Create new ",(0,l.kt)("inlineCode",{parentName:"p"},"webapp")," namespace for web application:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl create ns webapp\n")),(0,l.kt)("p",null,"Create virtual host configuration for NGINX server: "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-conf",metastring:'title="webapp.conf"',title:'"webapp.conf"'},"server {\n    listen 80 default_server;\n\n    root /srv/webapp;\n    index index.html;\n\n    server_name _;\n\n    access_log /var/log/nginx/webapp.access_log main;\n    error_log /var/log/nginx/webapp.error_log;\n\n    location / {\n        try_files $uri $uri/ =404;\n    }\n}\n")),(0,l.kt)("p",null,"Create ",(0,l.kt)("inlineCode",{parentName:"p"},"index.html")," file for web application:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-html",metastring:'title="index.html"',title:'"index.html"'},"<html>\n    <head>\n        <title>Welcome to WebAPP!</title>\n    </head>\n    <body>\n        <h1>Success! The WebAPP application is working!</h1>\n    </body>\n</html>\n")),(0,l.kt)("p",null,"Create ConfigMap with vhost configuration and ",(0,l.kt)("inlineCode",{parentName:"p"},"index.html"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl create configmap -n webapp webapp-conf --from-file=webapp.conf\nkubectl create configmap -n webapp webapp-html --from-file=index.html\n")),(0,l.kt)("p",null,"Prepare webapp Deployment manifest:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="deploy-webapp.yaml"',title:'"deploy-webapp.yaml"'},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: webapp\n  namespace: webapp\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: webapp\n  template:\n    metadata:\n      labels:\n        app: webapp\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.23.2\n        ports:\n        - containerPort: 80\n        volumeMounts:\n        - mountPath: /etc/nginx/conf.d\n          readOnly: true\n          name: webapp-conf\n        - mountPath: /srv/webapp\n          readOnly: true\n          name: webapp-html\n        - mountPath: /var/log/nginx\n          name: nginx-log\n      volumes:\n      - name: webapp-conf\n        configMap:\n          name: webapp-conf\n      - name: webapp-html\n        configMap:\n          name: webapp-html\n      - name: nginx-log\n        emptyDir: {}\n")),(0,l.kt)("p",null,"Create webapp Deployment which is relying on previous ConfigMap's:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f deploy-webapp.yaml\n")),(0,l.kt)("p",null,"Check Deployment, ReplicaSet and Pod status:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get events --sort-by='.lastTimestamp' -n myapp\nkubectl get deploy,rs,pods -n myapp -o wide\n")),(0,l.kt)("p",null,"To test webapp open tunnel connection to it:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl port-forward -n webapp pod/webapp-<POD_ID> 8080:80\n")),(0,l.kt)("p",null,"In new terminal test application:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"curl http://127.0.0.1:8080\n")),(0,l.kt)("p",null,"To cleanup remove ",(0,l.kt)("inlineCode",{parentName:"p"},"myapp")," namespace:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl delete ns myapp\n")),(0,l.kt)("h2",{id:"use-secret-object"},"Use Secret object"),(0,l.kt)("p",null,"Create ",(0,l.kt)("inlineCode",{parentName:"p"},"database")," namespace:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl create namespace database\n")),(0,l.kt)("p",null,"Create Secret object which will store MariaDB administrator password:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},'kubectl create secret -n database generic mariadb --from-literal=password="dbpassword"\n')),(0,l.kt)("p",null,"Deploy MariaDB instance which will use administrator password:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="deploy-mariadb.yaml"',title:'"deploy-mariadb.yaml"'},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: mariadb\n  namespace: database\n  labels:\n    app: mariadb\nspec:\n  selector:\n    matchLabels:\n      app: mariadb\n  template:\n    metadata:\n      labels:\n        app: mariadb\n    spec:\n      containers:\n      - image: mariadb:10.10\n        name: mariadb\n        env:\n        - name: MYSQL_ROOT_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: mariadb\n              key: password\n        ports:\n        - containerPort: 3306\n          name: mysql\n        volumeMounts:\n        - name: var-lib-mysql\n          mountPath: /var/lib/mysql\n      volumes:\n      - name: var-lib-mysql\n        emptyDir: {}\n")),(0,l.kt)("p",null,"Apply manifest on Kubernetes cluster:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f deploy-mariadb.yaml\n")),(0,l.kt)("p",null,"Check Deployment status:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get deploy,rs,pods -n database\n")),(0,l.kt)("p",null,"Open terminal to Pod container:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl exec -ti -n database mariadb-<POD_ID> -- bash\n  # env\n  # echo $MYSQL_ROOT_PASSWORD\n  # mysql -u root -p$MYSQL_ROOT_PASSWORD\n")),(0,l.kt)("p",null,"Output:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-console"},"Welcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MariaDB connection id is 7\nServer version: 10.10.2-MariaDB-1:10.10.2+maria~ubu2204 mariadb.org binary distribution\n\nCopyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMariaDB [(none)]> \n")),(0,l.kt)("p",null,"Clean up:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl delete ns database\n")))}c.isMDXComponent=!0}}]);